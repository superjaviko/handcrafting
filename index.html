<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
  <title>HUMANMADE+</title>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo {
      max-width: 140px;
      width: 40%;
      height: auto;
      margin-bottom: 10px;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
    }

    h1 {
      font-family: 'Playfair Display', serif;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-align: justify;
      margin-top: 0;
    }
    .intro-text {
      font-family: 'Playfair Display', serif;
      font-weight: 400; /* m√°s ligera que el t√≠tulo */
      letter-spacing: 0.2px;
      text-align:justify;
    }
    
     body {
     font-family: 'Playfair Display', serif;
     }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }

    .action-btn {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, #444, #222);
      color: #fff;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.3s;
    }

    .action-btn:hover {
      background: linear-gradient(135deg, #555, #333);
    }

    .action-btn:active {
      transform: scale(0.97);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2) inset;
    }

    .action-btn.active {
      background: linear-gradient(135deg, #222, #000);
      font-weight: bold;
    }

    .btn-chat {
      background: linear-gradient(135deg, #2c3e50, #34495e);
    }

    .btn-voice {
      background: linear-gradient(135deg, #8e44ad, #6c3483);
    }

    #contenidoObjeto,
    #respuestaChat {
      margin-top: 20px;
      padding: 16px;
      background: #f8f8f8;
      border-radius: 12px;
      font-size: 15px;
      text-align:justify;
      line-height: 1.5;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(5px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hidden {
      display: none;
    }

    .chat input {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      margin-bottom: 10px;
    }

    #btnInvia {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      background: #222;
      color: #fff;
      cursor: pointer;
    }

    
  </style>
</head>

<body>

  <div class="header">
    <img src="logo.png" alt="Logo Calabr√¨" class="logo">
  </div>

  <div class="container">
    <h1>Umanit√† Intrecciate</h1>

    <p class="intro-text">
      Benvenuti. Questo articolo ha una storia speciale.<br>
      Seleziona un'opzione per saperne di pi√π.
    </p>

    <div class="actions">
      <button class="action-btn" onclick="mostrarHistoria(this)">üìú Storia dell‚Äôoggetto</button>
      <button class="action-btn" onclick="mostrarSignificado(this)">üé® Cosa significa?</button>
      <button class="action-btn" onclick="mostrarProceso(this)">üõ†Ô∏è Come √® stato creato?</button>
      <button class="action-btn btn-chat" onclick="mostrarChat(this)">üí¨ Chiedi all'IA</button>
      <button class="action-btn btn-voice" onclick="iniciarVoz(this)">üé§ Parlare</button>
    </div>

    <div id="contenidoObjeto">
      <em>Seleziona un'opzione per visualizzare le informazioni.</em>
    </div>

    <!-- CHAT -->
    <div id="chat" class="chat hidden">
      <input
        type="text"
        id="pregunta"
        placeholder="Scrivi la tua domanda su questo articolo..."
      />

      <button id="btnInvia" onclick="enviarPregunta()">Invia domanda</button>

      <div id="respuestaChat">
        <em>Risposta.</em>
      </div>
    </div>
  </div>

<script>
let contenido = {};
let contenidoCargado = false;

/* =============================
   CARGA JSON
============================= */
fetch("contenido.json")
  .then(res => res.json())
  .then(data => {
    contenido = data;
    contenidoCargado = true;
  })
  .catch(() => {
    alert("Errore nel caricamento dei dati.");
  });

/* =============================
   UTILIDADES
============================= */
function activarBoton(btn) {
  document.querySelectorAll(".action-btn").forEach(b =>
    b.classList.remove("active")
  );
  if (btn) btn.classList.add("active");
}

function mostrarContenido(texto) {
  const box = document.getElementById("contenidoObjeto");

  if (!texto) {
    box.innerHTML = "<em>Contenuto non disponibile.</em>";
    return;
  }

  box.innerText = texto;
  box.classList.remove("fade-in");
  void box.offsetWidth;
  box.classList.add("fade-in");
}

function ocultarChat() {
  document.getElementById("chat").classList.add("hidden");
}

/* =============================
   BOTONES
============================= */
function mostrarHistoria(btn) {
  activarBoton(btn);
  ocultarChat();
  mostrarContenido(contenido.historia);
}

function mostrarSignificado(btn) {
  activarBoton(btn);
  ocultarChat();
  mostrarContenido(contenido.significatoSimbolico);
}

function mostrarProceso(btn) {
  activarBoton(btn);
  ocultarChat();
  mostrarContenido(contenido.processo);
}

function mostrarChat(btn) {
  activarBoton(btn);
  document.getElementById("contenidoObjeto").innerHTML = "";
  document.getElementById("chat").classList.remove("hidden");
}

/* =============================
   VOZ
============================= */
function hablar(testo) {
  const speech = new SpeechSynthesisUtterance(testo);
  speech.lang = "it-IT";
  window.speechSynthesis.speak(speech);
}

function iniciarVoz(btn) {
  mostrarChat(btn);

  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    mostrarContenido("Riconoscimento vocale non disponibile.");
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = "it-IT";
  recognition.start();

  mostrarContenido("üé§ In ascolto‚Ä¶");

  recognition.onresult = (event) => {
    document.getElementById("pregunta").value =
      event.results[0][0].transcript;
    enviarPregunta();
  };
}

/* =============================
   IA
============================= */
async function enviarPregunta() {
  if (!contenidoCargado) {
    alert("Il contenuto non √® ancora pronto. Riprova.");
    return;
  }

  const pregunta = document.getElementById("pregunta").value.trim();
  if (!pregunta) return;

  document.getElementById("respuestaChat").innerText = "Pensando‚Ä¶";

  const caratteristicheMaterialiTesto =
    contenido.caratteristicheMateriali
      ? `${contenido.caratteristicheMateriali.descrizione}
${(contenido.caratteristicheMateriali.fasi || []).join("\n")}
${contenido.caratteristicheMateriali.note || ""}`
      : "";

  const contesto = `
Nome oggetto: ${contenido.nomeOggetto}
Tipo oggetto: ${contenido.tipoOggetto}
Storia: ${contenido.historia}
Origine: ${contenido.origine}
Fonte: ${contenido.fonte}
Contesto: ${contenido.contesto}

Significato simbolico: ${contenido.significatoSimbolico}
Significato spirituale: ${contenido.significatoSpirituale}
Simboli: ${contenido.simboli}

Processo: ${contenido.processo}
Tecniche: ${contenido.tecniche}
Tempo: ${contenido.tempo}

Materiali: ${contenido.materiali}
Origine materiali: ${contenido.origineMateriali}

Caratteristiche materiali:
${caratteristicheMaterialiTesto}

Artigiano: ${contenido.artigiano}
Biografia:
${contenido.breveBiografia}

Funzione: ${contenido.funzione}
Importanza: ${contenido.importanza}
Curiosit√†: ${contenido.curiosita}
Raccomandazioni: ${contenido.raccomandazioni}
`;

  try {
    const response = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ pregunta, contenido: contesto })
    });

    const data = await response.json();

    if (!data.respuesta) throw new Error("Risposta vuota");

    document.getElementById("respuestaChat").innerText = data.respuesta;
    hablar(data.respuesta);

  } catch (err) {
    console.error(err);
    document.getElementById("respuestaChat").innerText =
      "‚ùå Errore nella risposta dell‚Äôassistente.";
  }
}
</script>
</body>
</html>
